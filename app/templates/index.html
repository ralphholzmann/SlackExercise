{% extends 'base.html' %}
{% import 'bootstrap/wtf.html' as wtf %}
{% from 'tags.html' import render_tag %}
{% block head %}
{{ super() }}
<link href="{{ url_for('static', filename='pagesummary.css')  }}" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js" type="text/javascript"></script>
<script>
  $(document).ready(function() {
      var SCROLLTOP_OFFSET = 100;
      var removeHighlighting = function() {
          var sourceTag = $('.page-source')[0];
          sourceTag.innerHTML = sourceTag.innerHTML.replace(
              /<span class="highlight">(&lt;\/?\s*[a-zA-Z0-9]+?\s*?.*?&gt;)<\/span>/gim,
              "$1");
      };
      $('.tag-name').click(function() {
          removeHighlighting();
          var tagName = $(this)[0].innerHTML;
          var sourceTag = $('.page-source')[0];
          var pattern = new RegExp('&lt;\/?\\s*' + tagName + '\\s*?.*?&gt;', 'gim');
          sourceTag.innerHTML = sourceTag.innerHTML.replace(
              pattern,
              '<span class="highlight">$&</span>');

          $('html, body').animate({
              scrollTop: $(".highlight").offset().top - SCROLLTOP_OFFSET
          }, 200);
      });
  });
</script>
{% endblock %}

{% block content %}
<div class="jumbotron">
    <div class="container">
        <div class="page-header">
            <h1> Page Summary Generator </h1>
        </div>
    </div>
</div>

<div class="container">
    {{ wtf.quick_form(form) }}
</div>

{% if summary %}
<div class="container">
    <div class="header">
        <h2> Tag Summary </h2>
    </div>
    {% for tag, tag_count in summary.iteritems() %}
    {{ render_tag(tag, tag_count) }}
    {% endfor %}
</div>
<div class="container">
    <div class="header">
        <h2> Page Source </h2>
    </div>
    <pre class="page-source-container">
       <code class="page-source">
         {{ source }}
       </code>
    </pre>
</div>
</div>
</div>

{% endif %}
{% endblock %}
